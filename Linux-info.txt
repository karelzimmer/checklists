# ##############################################################################
# Bestand:  Linux-info.txt
# Doel:     Tekstbestand met Linux opdrachten en informatie.
# Gebruik:  Als naslagwerk voor Linux-opdrachten en Linux-werkzaamheden.
# Auteur:   Karel Zimmer (https://karelzimmer.nl, info@karelzimmer.nl)
# ------------------------------------------------------------------------------
# Dit werk valt onder een Creative Commons Naamsvermelding-GelijkDelen 4.0
# Internationaal licentie (CC BY-SA 4.0).
# Bezoek http://creativecommons.org/licenses/by-sa/4.0/deed.nl om een kopie
# te zien van de licentie of stuur een brief naar Creative Commons,
# PO Box 1866, Mountain View, CA 94042, USA.
# ##############################################################################
# REL_NUM=01.17.00
# REL_DAT=2019-12-28
# REL_MSG='Wifi-opdrachten toegevoegd'

ALGEMEEN
--------
FILE=/home/karel/script.sh
dirname $FILE  . . directory /home/karel
                    alternatief: ${FILE%/*}
basename $FILE . . bestandsnaam script.sh
                    alternatief: ${FILE##*/}
"suffix" $FILE . . sh
                    ${FILE##*.} ("extensie")
"z/suffix" $FILE . /home/karel/script
                    ${FILE%.*}  (naam zonder suffix)
sudo !!  . . . . . herhaal de vorige opdracht als root
                  (handig als je eerst een melding krijgt "Need to be root" o.i.d.)
gksu <opdracht>  . vervangen door opdracht: sudo -i
gksudo <opdracht>  vervangen door opdracht: sudo -i
sudo -i <opdracht> voer <opdracht> als root uit (vervanger van gksu/gksudo)
history  . . . . . overizcht laatst uitgevoerde opdrachten
!<nummer>  . . . . voer history-opdrachtnummer <nummer> uit
grep '^#1' * . . . vind bestanden met #1 aan het begin van de regel
grep '\ \ $' * . . vind bestanden met twee spaties aan het einde van de regel
\<opdracht>  . . . "unalias" opdracht, voer niet alias uit, maar de opdracht
                   waar de alias naar verwijst
convert -density 150 "xyz.pdf" -quality 90 output.jpg
idenity "xyz.{png,jpg,svg}"
md5sum -c F  . . . controleer md5sums genoemd in bestand F tegen bestanden in
                   deze map, handig bij beeldbestanden (.iso)
sudo fdisk -l  . . overzicht schijven uit partitietabel
df -h  . . . . . . filesysteem disk ruimte gebruik (human readable)
sudo blkid . . . . print block device attributes
sudo vol_id /dev/? probe filesystem type and read label and uuid
du -h (du -hs) . . schijfgebruik (samenvatten)

ip a . . . . . . . IP-address tonen
arp  . . . . . . . toon IP-adressen (lokaal) netwerk
ssh user@ip  . . . remote login van user op ip
nmap -sP 192.168.192.0/24 . . toon welke host up is
sudo arp-scan -l  . . . . . . id, met MAC-address (sudo apt install apt-scan)
sudo dd if=/dev/zero of=/dev/sd? bs=512 count=1  partitiegegevens verwijderen

tail -f /var/log/messages  . alle nieuwe logging-regels komen voorbij (niet-systemd)
journalctl . . . . . . . . . lees systemd journal (log)
systemd-analyze plot > $HOME/$HOSTNAME-plot.html . . bootchart
    Om systemd journal te bewaren na een reboot:
    sudo mkdir -p /var/log/journal
    sudo systemctl reboot
    journalctl --list-boots:
    -1 5cfbda4c9e054365989466fefa396995 vr 2016-08-12 19:03:12 CEST—vr 2016-08-12 19:09:49 CEST
     0 589f45bf8c4a432da15c14083770533c vr 2016-08-12 19:10:18 CEST—vr 2016-08-12 19:14:09 CEST
    Gebruiken bepaalde log via:
    journalctl -k -b -1     (Alleen kernelboodschappen uit log 5cfbda4c9e054365989466fefa396995
    Zie voor verdere mogelijkheden:
    man journalctl
    Terugdraaien systemd journal te bewaren na een reboot:
    sudo rm -fr /var/log/journal
systemd-analyze . . . . . Analyze and debug system manager
systemd-analyze blame . . id, list of all running units, ordered by the time
    they took to initialize
systemd-analyze plot > ~/boot.html
  . . . . . . . . . . . . prints an SVG graphic detailing which system services
    have been started at what time, highlighting the time they spent on initialization.
systemd-analyze plot > ~/boot.html; firefox ~/boot.html id, gelijk in de browser

sudo dmidecode - DMI (Desktop Management Interface) table decoder
                (aka SMBIOS - System Management BIOS)
sudo dmidecode -t 16 . . . . max RAM, aantal slots
sudo dmidecode -t memory . . max RAM, aantal slots, RAM aanwezig
lsb_release -a . . distributie informatie (Linux Standard Base -all)
Zie ook  . . . . . cat /etc/*release
uname -r . . . . . toon de release van de kernel
env  . . . . . . . . toon omgevingsvariabelen
declare -p . . . . . toon van elke variabele de eigenschappen en waarde

fuser <filesystem> . . . . . wie heeft filesystem in gebruik
type [-a] <command>  . . . . . wat voor type <command> en waar bevindt deze zich
which [-a] <command>  . . . . . . waar bevindt <command> zich
find . -type f -print0 | xargs -0 chmod ?
                   wijzig rechten files, niet directories
locate <?> . . . . . . . . . vind bestand <?>, gebruik ervoor sudo updatedb
whereis <command>  . . . . . waar binary, source, en man page files <command>
file <bestand> . . . . . . . wat voor bestand is <bestand>
stat <bestand> . . . . . . . toon bestand status van <bestand>
stat -f <bestand>  . . . . . toon bestandssysteem status van <bestand>
gnomevfs2-info <bestand> . . uitgebreide info over bestand <bestand>,
                             vereist pakket libgnomevfs2-bin

help <command> . . alle interne shell-opdrachten opgesomd
info <command> . . lees documentatie in Info formaat (info page = GNU style)
man <command>  . . lees on-line reference manuals    (manpage = UNIX style)
man [<sectie>] <command>:
       1   Executable programs or shell commands
       2   System calls (functions provided by the kernel)
       3   Library calls (functions within program libraries)
       4   Special files (usually found in /dev)
       5   File formats and conventions eg /etc/passwd
       6   Games
       7   Miscellaneous (including macro packages and conventions)
       8   System administration commands (usually only for root)
       9   Kernel routines [Non standard]
man hier . . . . . beschrijving van filesysteem-hiërarchie
man -k zoekarg . . vind manual pages met keyword zoekarg
                   (v/h apropos -r zoekarg)
man -f zoekarg . . vind manual pages met referenties naar zoekarg
                   (v/h whatis -r zoekarg)
man -K zoekarg . . vind manual pages met tekst zoekarg
man -t command | ps2pdf - filename.pdf . .
               . . maak PDF filename.pdf van man command
pdfunite in-1.pdf in-2.pdf in-n.pdf out.pdf
               . . PDFs combineren
enscript -p output.ps ./scripts/deploy
+
ps2pdf output.ps output.pdf
               . . Text naar PDF

sudo apt install chkrootkit
sudo apt install rkhunter
sudo /usr/bin/rkhunter -c  . . . . check op sporen van rootkits
sudo /usr/sbin/chkrootkit  . . . . check op sporen van rootkits
less: spatiebalk, PageUp, PageDown blader per scherm
      enter, pijltje naar beneden  regel omlaag
      b, pijltje omhoog            regel omhoog
      /xyz                         zoek xyz
                                   n = zoek volgende
      q                            quit
      h                            help

zgrep, zcat, zless is id. zonder de z maar dan op gzip-bestanden
sudo lshw -html > $HOSTNAME-lshw.html . . . Harwareoverzicht in een webpagina
hardinfo  . . . . . . . . . Als lshw maar uitgebreider
                            (installeer met sudo apt install hardinfo)
sudo dmidecode  . . . . . . Dump DMI/SMBIOS hardware-tabel
watch CMD . . . . . . . . . Herhaal CMD volledig-scherm, std. iedere 2 sec.
rpm omzetten naar deb . . . sudo apt install alien
                            sudo alien --to-deb --scripts *.rpm
gnome-session-save --logout . . afmelden

sudo systemctl reboot . . . . . herstarten
sudo systemctl poweroff . . . . uitschakelen
reboot nodig? check: /var/run/reboot-required
id . . . . . . . . . . . . . . . . Gebruikersinformatie

sudo deluser --remove-all-files U  Gebruiker U verwijderen incl. pers.mappen
sudo usermod --uid UID U . . . . . Wijzig gebruiker U naar numerieke user ID
                                 Voorbeeld: sudo usermod --uid 1001 beheerder
chage  . . . . . . . . . . . . . . Wijzig wachtwoord verval informatie
    Voorbeeld: chage -l <user>          toon gebruiker wachtwoord verval info
               chage -M <dag> <user>        wachtwoord vervalt na <dag> dagen
               chage -E "JJJJ-MM-DD" <user>  gebruiker vervalt op JJJJ-MM-DD
sudo chown -R {USER}:{USER} .* . . Rechten zetten voor gebruiker en groep

shred --verbose --zero /dev/hda  . Schijf /dev/hda leegmaken (zie ook DBAN)

cat -Ante <bestand>  . . . . . . . Toon LF als '$' (Linux-standaard),
                                   CR als '^M', TAB als '^I'
tac  . . . . . . . . . . . . . . . omgekeerde van cat
strings  . . . . . . . . . . . . . Toon leesbare/printbare tekens in een (binair) bestand
shell script debuggen  . . . . . . [sudo] bash -vx ./<script.sh>
                        v = verbose (elke invoerregel tonen)
                        x = xtrace  (elke opdracht tonen)
#                       n = noexec  (opdrachten lezen maar niet uitvoeren)
readelf . . . Toon info over Executable and Linking Format uitvoerbare programma's
diff  . . . . diff --context <orig.best.> <gewijz.best.> > <patchbest.>
patch . . . . patch <orig.best.> <patchbest.>
Zwart scherm bij opstarten? Probeer een 'nomodeset' op te geven als opstart-
parameter. Ref: http://askubuntu.com/questions/162075/

ssh
===
HOST-B:
Indien nodig maak remote gebruiker aan.

Gebruiker is WEL zichtbaar op aanmeldscherm, normale gebruiker:
sudo useradd -m -s /bin/bash -c 'USERNAME' -G EXTRAGROUP,... USER
-OF-
Gebruiker is NIET zichtbaar op aanmeldscherm, systeemgebruiker:
sudo useradd -m -r -s /bin/bash -c 'USERNAME (systeemgebruiker)' -G EXTRAGROUP[,...] USER

(lange opties:
sudo useradd --create-home --system --shell /bin/bash --comment 'USERNAME (systeemgebruiker)' --groups EXTRAGROUP[,...] USER
)

Voorbeeld:
sudo useradd -m -r -s /bin/bash -c 'Testuser (systeemgebruiker)' -G sudo test

sudo passwd USER

(opruimen: sudo userdel -r test)

HOST-A:
cd /home/USER/.ssh
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
Enter passphrase (empty for no passphrase): [Type a passphrase]
Enter same passphrase again: [Type passphrase again]

/usr/bin/ssh-copy-id -i  /home/USER/.ssh/id_rsa.pub HOST-B
Voorbeeld:
/usr/bin/ssh-copy-id -i  /home/test/.ssh/id_rsa.pub 92.168.178.181

ssh HOST-B

ALG:

sudo vi /etc/hosts
IP-HOST-B HOST-B

ssh HOST-B:
Enter passphrase for key '/home/USER/.ssh/id_rsa': ?
HOST-A:
ssh-add /home/USER/.ssh/id_rsa ! 

ssh-keygen -Bfid_rsa            (Toon bubblebabble digest private/public key file)
ssh-keygen -lf id_rsa.pub       (Toon fingerprint public key file.)

openssl rsa -text -in id_rsa    (Toon de private key in text, geef passphrase)
openssl rsa -text -pubout -in id_rsa
                                (Toon de public key in text, geef passphrase)

mail
====
# E-mail vanaf cmdline!

# INSTALLEER
# Installeer NSS-tools/mailtools/BSD mail
sudo apt install libnss3-tools mailutils s-nail
sudo update-alternatives --set mailx /usr/bin/s-nail

# STEL IN
#grep --quiet --regexp='mailx' $HOME/.bash_aliases || echo "alias mailx='/usr/bin/s-nail'" >> $HOME/.bash_aliases

mkdir $HOME/.certs

certutil -N -d $HOME/.certs
# Geeft tweemaal ww

echo -n | openssl s_client -connect smtp.gmail.com:465 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > $HOME/.certs/gmail.crt

certutil -A -n "Google Internet Authority" -t "C,," -d $HOME/.certs -i $HOME/.certs/gmail.crt

# Verstuur e-mail met cmd:
echo -e "<Email content>" | mailx|s-nail -s "<Email subject>" -S smtp-use-starttls -S ssl-verify=ignore -S smtp-auth=login -S smtp=smtp://smtp.gmail.com:587 -S from="<Gmail mail address>" -S smtp-auth-user="<Gmail mail address>" -S smtp-auth-password=<Google App password> -S ssl-verify=ignore -S nss-config-dir=$HOME/.certs <To Email address>

-OF-

# Maak mailconfigbestand
touch $HOME/.mailrc
# Inhoud:
set smtp-use-starttls
set ssl-verify=ignore
set smtp-auth=login
set smtp=smtp://smtp.gmail.com:587
set from="<Gmail mail address>"
set smtp-auth-user="<Gmail mail address>"
set smtp-auth-password=<Google App password>
set ssl-verify=ignore
set nss-config-dir=$HOME/.certs

chmod 600 $HOME/.mailrc

# Mail dan met:
echo -e "<Email content>" | mailx|s-nail -s "<Email subject>" <To Email address>


systemd operatie                systemd opdracht
=============================== =================================
Start service                   systemctl start $unit
Stop service                    systemctl stop $unit
Restart service                 systemctl restart $unit
See status of services          systemctl [status]
Check configuration is valid    systemd-analyze verify <unit_file>
Show job environment            systemctl show-environment
Set job environment variable    systemctl set-environment foo=bar
Remove job environment variable systemctl unset-environment foo
View job log                    sudo journalctl [-u $unit]
tail -f job log                 sudo journalctl -u $unit -f
Show rel.ship between services  systemctl list-dependencies --all
systemctl list-units --type=target        list loaded units
systemctl list-units --type=target –all   list all loaded inactive units too

MultiCD
-------
1. Open Terminal
2. cd
3. git clone git://github.com/IsaacSchemm/MultiCD.git
4. Zet iso's in $HOME/MultiCD
5. cd MultiCD
6. chmod +x multicd*.sh
7. ./multicd*.sh
8. sudo blkid (controleer /dev/sdb) 
9. sudo dd if=./build/multicd.iso of=/dev/sdb bs=4M status=progress; sudo sync

KVM (Kernel-based Virtual Machine)
----------------------------------
Ref:
    https://help.ubuntu.com/community/KVM
    http://www-01.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaatkvm.htm
Virtualisatie CPU:
    VT-x (code name Vanderpool) and AMD-V (code name Pacifica)
Controleer virtualisatie-ondersteuning CPU:
    egrep -c '(vmx|svm)' /proc/cpuinfo
        0   - niet
        >=1 - OK, maar check BIOS dat virtualisatie is aangezet
Controleer 64-bit CPU:
    egrep -c ' lm ' /proc/cpuinfo
        0   - geen 64-bit CPU
        >=1 - OK
Controleer KVM-ondersteuning:
    kvm-ok
        INFO: /dev/kvm exists
        KVM acceleration can be used
Opslagplekken:
    Configuratie: /etc/libvirt/qemu/
    VDIs: /var/lib/libvirt/images/
Wijzig opslagplek:
sudo mv /var/lib/libvirt/images/Ubuntu16.05 /home/karel/libvirt/images
virsh edit Ubuntu16.04
(wijzig naar <source file='/home/karel/libvirt/images/Ubuntu16.04.img'/>)

Herstel Bestanden thumbnails
----------------------------
Verwijder $HOME/.cache/thumbnails/fail

Linux performance monitoring tools
----------------------------------
top  . . . . . . . welk proces gebruikt meeste CPU, geheugen en swapruimte
vmstat . . . . . . systeemactiviteit, hardware- en systeeminformatie
uptime, w  . . . . gemiddelde systeembelasting
w  . . . . . . . . gemiddelde systeembelasting en wie is aangelogd
systemctl status --all
               . . toon volledige informatie over alle processen
pstree . . . . . . hele boom van alle processen
free -m  . . . . . beschikbaar en in-gebruikt geheugen (megabytes)
iostat . . . . . . gemiddelde CPU-belasting en schijfactiviteit
sar  . . . . . . . verzamel en rapporteer systeemactiviteit
mpstat . . . . . . multiproccesorgebruik
numastat . . . . . NUMA-gerelateerde statistieken (Non-Uniform Memory Access)
pmap . . . . . . . proces gehuegen gebruik
netstat  . . . . . netwerkstatistieken
iptraf . . . . . . real-time netwerkstatistieken
tcpdump  . . . . . gedetaileerde netwerverkeer analyse
ethereal . . . . . gedetaileerde netwerverkeer analyse
nmon . . . . . . . verzamel en rapporteer systeemactiviteit
stat . . . . . . . toon status bestanden/bestandssysteem (ook octaal!)
strace . . . . . . system calls tracen, voorbeeld: strace ls 2> strace.out
/proc  . . . . . . diverse kernelstatistieken

Linux benchmark tools
---------------------
lmbench  . . . . . Microbenchmark voor besturingssyteemfuncties
iozone . . . . . . Bestandssysteem benchmark
netperf  . . . . . Netwerkprestatie benchmark

ls-familie
----------
lspci  . . . . . . PCI
lsusb  . . . . . . USB
lshw . . . . . . . hardware
lsof . . . . . . . open files
lsblk  . . . . . . hele boom van alle block-devices (opslag)
lsinitramfs  . . . modules in initrd.img

Netwerk
-------
ip . . . . . . . . configureer netwerk interface
iwconfig . . . . . configureer wireless network interface
iwlist scan  . . . zoek naar draaloze netwerken
rfkill list all  . toon draadloze apparaten
sudo systemctl restart NetworkManager.service . . Netwerk herstarten
host <host>  . . . look up hostnames using DNS
nslookup <host>  . look up name servers interactively
dig <host> . . . . look up domain name information from nameserver
ss . . . . . . . . another utility to investigate sockets

Netwerkverbinding vóór het aanmelden?
-------------------------------------
Rechtsklik bovenin op netwerk-icoon, kies Verbindingen bewerken, klik op
gewenste verbinding en vervolgens op Bewerken.
 Klik op Algemeen (tab) en vink aan Alle gebruikers kunnen verbinding maken
met dit netwerk. Klik op Opslaan.
-of-
Ga naar /etc/NetworkManager/system-connections.
Edit gewenste verbinding en haal alles weg achter permissions=
Klaar.

MAC address spoofing
--------------------
# ip link show <interface>  (<interface> zie iwlist scan)
    voorbeeld: ...link/ether 00:1d:98:5a:d1:3a <== MAC address
# ip link set dev <interface> down
# ip link set dev <interface> address XX:XX:XX:XX:XX:XX
# ip link set dev <interface> up

Canon MG3500/MP495-serie netwerkprinter/scanner op WiFi aansluiten
------------------------------------------------------------------
1.  Sluit de computer bedraad aan op de router.
2.  Leg beveiligingsinstellingen router vast (schermafdruk via Shift-PrtSc)
3.  Druk 11x op Onderhoud tot omgekeerde U en druk dan op Zwart (Black) of
    Kleur (Color) om een netwerkconfiguratieoverzicht te printen, let op
    MAC Address.
4.  Druk 14x op Onderhoud tot t en druk dan op Zwart (Black) of Kleur (Color)
    om de printer WiFi-deel te resetten (WiFi-lampje gaat uit).
5.  Druk 13x op onderhoud tot G en druk dan op zwart (black) of kleur (color)
    om WiFi aan te zetten (WiFi-lampje brandt blauw).
6.  Login op de router en zet SSID op BJNPSETUP zonder beveiliging en wacht
    tot het IP-adres van de printer verschijnt, zie MAC Address op afdruk
    netwerkconfiguratieoverzicht.
7.  Ga met de bowser naar dat IP-adres, log in op de printer, en klik op
    Network Settings.
8.  Wijzig eerst de beveiliging naar de gewenste waarde via een klik op
    Modify (achter Encryption Method), en wijzig daarna het SSID naar de
    gewenste waarde
9.  Login op de router en wijzig SSID en beveiliging naar de gewenste waarden
10. Verwijder de netwerkkabel.
11. Stuur een printje naar de printer en maak een scan.
Gebruikte opdrachten:
cngpij -P <printernaam>                 Printerinstellingen
cngpijmonmp495                          Printermonitor (mp495-series)
cnijfilter-mp495series-pkgconfig.sh     Canon Inkjet Printer Driver for Linux
cnijnetprn --search auto                Printer zoeken
scangearmp                              Scannerprogramma
scangearmp-mp495series-pkgconfig.sh     ScanGear MP for Linux (mp495-series)
scanimage -L                            Scanner zoeken
Apparaat-URI:
cnijnet:/<MAC-address>                  (cnijnet=protocol)

NVIDIA repareren
----------------
sudo apt-get remove nvidia-173 nvidia-current nvidia-current-updates
sudo apt-get autoclean
sudo apt-get autoremove
sudo apt install nvidia-current-updates

boot-repair (ook vanaf live-CD)
-------------------------------
sudo add-apt-repository ppa:yannubuntu/boot-repair
sudo apt-get update
sudo apt install boot-repair    (voor repareren GRUB: Boot-reparatie)
sudo boot-repair
sudo apt install startupmanager (evt voor aanpassen GRUB: Opstart-Manager)
sudo startupmanager

GRUB-menu zichtbaar maken
-------------------------
1. sudo -i
2. gedit /etc/default/grub
*. Wijzig: #GRUB_HIDDEN_TIMEOUT=0
           #GRUB_HIDDEN_TIMEOUT_QUIET=true
3. sudo update-grub
4. exit

GRUB-menu ander menuitem starten
--------------------------------
1. sudo -i
2. gedit /etc/default/grub
*. Wijzig: GRUB_DEFAULT=0 -> GRUB_DEFAULT=1 (of 2, 3, etc.)
3. sudo update-grub
4. exit

Pakketinformatie
----------------
sudo add-apt-repository --remove ppa:<ppa>  . verwijder <ppa>. behoud pakketten
sudo apt install ppa-purge . . . . installeer pakket om ppa's te verwijderen
sudo ppa-purge ppa:<ppa> . . . . . . . verwijder <ppa> incl. pakketten
sudo apt-get update  . . . . . . . . . werk pakketlijsten bij
sudo apt-get upgrade . . . . . . . . . installeer geupdate pakketten
Reboot nodig? Check bestaan file /var/run/reboot-required
sudo apt-get dist-upgrade  . . . . . . installeer nieuwe distributie
sudo apt-get install <pakket>  . . . . installeer pakket
sudo apt-get remove <pakket> . . . . . verwijder pakket (excl. configuratiebestanden)
sudo apt-get purge <pakket>  . . . . . verwijder pakket volledig
sudo apt-get --purge remove <pakket> . verwijder pakket volledig
sudo apt-get autoremove  . . . . . . . verwijder pakketten die automatisch
                                       zijn gedownload maar niet meer nodig
sudo apt-get source <pakket> . . . . . download source pakket
apt-get changelog <pakket> . . . . . . download en toon changelog pakket
apt-cache search "zoekstring"  . . . . zoek naar pakket
apt-cache show <pakket>  . . . . . . . toon informatie over pakket
apt-cache policy . . . . . . . . . . . toon prio pakketbronnen
apt-cache policy <pakket>  . . . . . . toon prio-keuze pakket
dpkg --status <pakket> . . . . . . . . overzicht van de status van een pakket
dpkg --listfiles <pakket> . . . . . .  overzicht van bestanden in een pakket
dpkg --search <bestand>  . . . . . . . welk pakket gebruikt een bestand
dpkg --search $(which <commando>)  . . welk pakket heeft bestand geinstalleerd
dpkg --info <bestand>  . . . . . . . . informatie over een pakket
dpkg --install <bestand> . . . . . . . installeer bestand
dpkg --add-architecture <arch> . . . . voeg architectuur <arch> toe
# Architectuur i386 toevoegen is nodig voor 64-bit Debian, 64-bit Ubuntu is
# reeds "multi-arch": sudo dpkg --add-architecture i386;sudo apt-get update
# Controle op 64-bit systeem: dpkg --print-foreign-architectures, geeft: i386
dpkg --print-architecture  . . . . . . toon basis-architectuur
dpkg --print-foreign-architecture  . . toon toegevoegde architectuur
sudo debconf-show --listowners
via
    sudo debconf-show icaclient
-en
    sudo debconf-show ttf-mscorefonts-installeer
-en
    sudo debconf-show devolo-dlan-cockpit
dan
    echo 'icaclient icaclient/accepteula select true' | sudo debconf-set-selections
+en
    echo 'ttf-mscorefonts-installeer msttcorefonts/accepted-mscorefonts-eula select true' | sudo debconf-set-selections
+en
    echo 'devolo-dlan-cockpit devolo-dlan-cockpit/data_collection_allowed select false' | sudo debconf-set-selections
apt-file update;apt-file search <bestand> . . welk pakket zorgt voor bestand
Welke pakketten zijn door de gebruiker geïnstalleerd:
http://askubuntu.com/questions/32007/how-to-find-manually-installed-packages
http://askubuntu.com/questions/2389/generating-list-of-manually-installed-packages-and-querying-individual-packages
Eigen .deb maken:
https://ubuntuforums.org/showthread.php?t=910717
http://www.webupd8.org/2010/01/how-to-create-deb-package-ubuntu-debian.html
http://www.webupd8.org/2010/03/2-ways-of-reinstalling-all-of-your.html
https://debian-handbook.info/browse/nl-NL/stable/sect.package-meta-information.html

Pakketbeheerder herstellen
--------------------------
sudo apt-get update --fix-missing
sudo dpkg --configure --pending
sudo apt-get install --fix-broken

Gebruikersinstellingen opzoeken GNOME/Unity
-------------------------------------------
CLI:    gsettings list-schemas
        gsettings list-keys <schema>[:<path>]
        gsettings list-recursively [<schema>[:<path>]]
        gsettings range [<schema>[:<path>]]
        gsettings get <schema>[:<path>] <key>
        gsettings reset <schema>[:<path>] <key>  (naar default waarde gaan)
        dconf reset -f /    reset ALLES !! VOORZICHTIG !!
        gconftool-2 --get /apps/gedit-2/plugins/active-plugins
GUI:    dconf-editor (GNOME 3)
        gconf-editor (GNOME 2)
Als je wilt weten wat er wijzigt na een handeling in de GUI:
gsettings list-recursively > /tmp/before
Wijzig bijvoorbeeld de schaal via Systeeminstellingen > Schermen
gsettings list-recursively > /tmp/after
diff /tmp/before /tmp/after | grep '[>|<]'
Zie ook script gset.
gnome-shell-extension-prefs <UUID>
gnome-shell-extension-tool

Gebruikersinstellingen opzoeken LXDE en Xfce
--------------------------------------------
xfconf = Command line utility for xfconf system
xfconf-query --list
Kanalen:
  xfce4-keyboard-shortcuts
  xfce4-power-manager
xconf-query --channel xfce4-power-manager --monitor --verbose
Open menu > Voorkeuren > Energiebeheer > Algemeen (tab) > laptopdeksel,
wijzig instellingen:
/xfce4-power-manager/lid-action-on-battery (1)
/xfce4-power-manager/lid-action-on-ac (1)
NB:
(0) = Beeldscherm uitschakelen
(1) = Pauzestand (gewenst)
(2) = Scherm vergrendelen
xfconf-query --channel xfce4-power-manager --list --verbose
(Properties:)
/xfce4-power-manager/brightness-switch                  0
/xfce4-power-manager/brightness-switch-restore-on-exit  1
/xfce4-power-manager/lid-action-on-ac                   1
/xfce4-power-manager/lid-action-on-battery              1
/xfce4-power-manager/logind-handle-lid-switch           true
/xfce4-power-manager/power-button-action                3
/xfce4-power-manager/show-tray-icon                     1
xfconf-query --channel xfce4-power-manager --property /xfce4-power-manager/lid-action-on-battery --set 1
xfconf-query --channel xfce4-power-manager --property /xfce4-power-manager/lid-action-on-ac --set 1
Voeg '--create' toe!!

Zorg dat de helderheid van laptopscherm correct is bij het opstarten
--------------------------------------------------------------------
1. Zet helderheid op de gewenste waarde.
2. Vraag helderheid op met $ cat /sys/class/backlight/acpi_video0/brightness
   Zeg dat hier N gemeld wordt.
3. sudo -i
4. gedit /etc/rc.local
*. Voeg regel toe: echo N > /sys/class/backlight/acpi_video0/brightness
5. exit
NB Er kan ook een andere map staan in /sys/class/backlight/, bijv. radeon_bl0

Paaseieren
----------
apt-get moo
aptitude moo, aptitude -v moo, aptitude -vv moo, aptitude -vvv moo, etc.

Rechten
-------
Octaal (achttallig stelsel, 0 t/m 7):
+--2²=4
|+-2¹=2
||+2⁰=1
|||
VVV
421
rwx
000 --- 0
001 --x 1
010 -w- 2
011 -wx 3
100 r-- 4
101 r-x 5
110 rw- 6
111 rwx 7
rwx
DUUUGGGOOO = Directory (map, - is gewoon bestamd), User (gebruiker),
             Group (groep), en Other (rest).
Bestandsrechten, de betekenis van de r, w, en x attributen:
    r - Bestand lezen.
    w - Bestand wijzigen.
    x - Bestand uitvoeren.
Maprechten, de betekenis van de r, w, en x attributen:
    r - Inhoud van map opvragen (ls <mapnaam>) als ook het x-attribuut is aangezet.
    w - Bestanden aanmaken, verwijderen, of hernoemen als ook het x-attribuut is aangezet.
    x - Toegang tot de map (cd <mapnaam>), "zoeken".
Basisrechten (base permissions):
dirs    777 (rwxrwxrwx)
files   666 (rw-rw-rw-)
Umask (user mask):
normal 0002 (dan zijn u=rwx, g=rwx, en o=rx de maximaal toegestane waarden)
root   0022 (dan zijn u=rwx, g=rx,  en o=rx de maximaal toegestane waarden)
Standaard wordt een bestand of map aangemaakt met de rechten van
Basisrechten -/- Umask.
Resultaat als een normale user een map of bestand aanmaakt:
mkdir   775 (rwxrwxr-x) (777 -/- 002)
touch   664 (rw-rw-r--) (666 -/- 002)
Resultaat als de beheerder (superuser of root) een map of bestand aanmaakt:
mkdir   755 (rwxr-xr-x) (777 -/- 022)
touch   644 (rw-r--r--) (666 -/- 022)

Draai 90 graden iPhone film
---------------------------
mencoder -vf rotate -o Input.MOV -oac lavc -ovc lavc Output.MOV

Grafische effecten
------------------
Gebruik
-------
Bestuur met Ctrl+Alt en sleep met de muis (Linkermuistoets).
Zie Sneltoetsen voor grafische effecten (Compiz-toetsen.txt).
In gebruik zijnde toetscombinaties
----------------------------------
for i in $(gconftool-2 --get /apps/compiz-1/general/screen0/options/active_plugins|tr '[],' ' ')
    do
        echo "# $i:"
        gconftool-2 -a /apps/compiz-1/plugins/"$i"/screen0/options |
            grep "_key\|_button\|trigger_\|initiate\ \|panel_first_menu\|keyboard_focus\|execute_command\|show_launcher" |
            grep -v "Disabled\|=[[:space:]]*$" |
            sort
    done

Starters
--------
Starters, "launchers", zijn zogenaamde bureaublad-configuratiebestanden,
.desktop-bestanden of "desktop entries". In gebruik bij KDE- en GNOME-
gebaseerde systemen en opgeslagen in:
    per gebruiker (lokaal)
        $HOME/.local/share/applications
    per systeem (globaal)
        /usr/share/applications
        /usr/share/app-install/desktop
In deze lokatie geplaatst kan de starter gevonden worden met de Snelzoeker.
Zie de opdrachten
    desktop-file-install
    desktop-file-edit
    desktop-file-validate
    update-desktop-database
Zie ook
    http://standards.freedesktop.org/desktop-entry-spec
    http://freedesktop.org/wiki/Specifications/icon-theme-spec
Icons:
    per gebruiker (lokaal)
        $HOME/.local/share/icons
    per systeem (globaal)
        /usr/share/icons/gnome/

Controleer USB-stick
--------------------
sudo qemu-system-x86_64 -enable-kvm -m 512 -hda /dev/sdb
sudo qemu-system-i386   -enable-kvm -m 512 -hda /dev/sdb

Herstel verwijderde "Locaties" Afbeeldingen, Documenten, Downloads, etc.
------------------------------------------------------------------------
Maak Afbeeldingen, Documenten, Downloads, etc. map aan in Persoonlijke map
$ gedit $HOME/.config/user-dirs.dirs
Wijzig XDG_PICTURES_DIR="$HOME/"  naar XDG_PICTURES_DIR="$HOME/Afbeeldingen"
Wijzig XDG_DOCUMENTS_DIR="$HOME/" naar XDG_DOCUMENTS_DIR="$HOME/Documenten"
Wijzig XDG_DOWNLOAD_DIR="$HOME/"  naar XDG_DOWNLOAD_DIR="$HOME/Downloads"
etc.
Weer af- en aanmelden!

TeamViewer commando's
---------------------
teamviewer --daemon status      show current status of the TeamViewer daemon
teamviewer --daemon start       start TeamViewer daemon
teamviewer --daemon stop        stop TeamViewer daemon
teamviewer --daemon restart     stop/start TeamViewer daemon
teamviewer --daemon disable     disable TeamViewer daemon - don't start daemon on system startup
teamviewer --daemon enable      enable TeamViewer daemon - start daemon on system startup (default)
SSD
---
sudo fstrim -v /

Mozilla Firefox
---------------
about:              <over>
about:blank         <lege pagina>
about:buildconfig   about:buildconfig
about:cache         Information about the Cache Service
about:config        Aanpassen uitgebreide voorkeuren
about:crashes       Verzonden crashrapporten
about:credits       Our Contributors
about:license       about:license
about:logo          <afbeelding logo>
about:robots        Welcome Humans!
about:mozilla       ... from The Book of Mozilla
about:plugins       Geïnstalleerde plug-ins

Afmelden via command line
-------------------------
gnome-session-quit

Suffix toevoegen aan bestanden
------------------------------
find . -name "install-*" -type f -exec mv '{}' '{}'.sh \;
Alle install-* bestanden worden "hernoemd" naar install-*.sh

Sorteer voortgangsteksten install. en Instell.bestanden
-------------------------------------------------------
grep '#1' setup-Ubuntu-GNOME-16.04-desktop-algemeen.sh | cut -b 12-|sort -f

Encryptie aan (van niet-VPM naar VPM)
-------------------------------------
VPM = Versleutelde Persoonlijke Map(pen)
Ref (o.a.):
http://blog.dustinkirkland.com/2011/02/long-overdue-introduction-ecryptfs.html
Voer uit onder andere gebruiker dan USER.
Maak evt. een tempuser aan!
LET OP: maximale bestandsnaamlengte is na versleutelen 142 (i.p.v. 255)!
sudo ecryptfs-migrate-home -u USER Persoonlijke map van USER versleutelen
                                   (vereist pakket ecryptfs-utils)
sudo ecryptfs-setup-swap . . . . . swap versleutelen
                                   (vereist pakket cryptsetup)
ecryptfs-unwrap-passphrase . . . . Toon random gegenereerde mount passphrase
ecryptfs-umount-private  . . . . . Versleutelde map afkoppelen
ecryptfs-mount-private . . . . . . Versleutelde map aankoppelen
ecryptfs-recover-private . . . . . Versleutelde map aankoppelen (met live-CD)
/home/.ecryptfs/$USER/.Private -> /home/$USER/.Private
    (Ontsleutelde persoonlijke map van $USER)
/home/$USER/.ecryptfs -> /home/.ecryptfs/$USER/.ecryptfs
    (Configuratie gegevens van $USER)

Encryptie uit (van VPM naar niet-VPM)
-------------------------------------
VPM = Versleutelde Persoonlijke Map(pen)
Ref: http://www.howtogeek.com/116179/how-to-disable-home-folder-encryption-after-installing-ubuntu/
     http://askubuntu.com/questions/4950/how-to-stop-using-built-in-home-directory-encryption
     http://www.logilab.org/29155 (swap)
Stel twee gebruikers, A en B.
Beide met Beheerdersrechten.
Gebruiker A heeft een Versleutelde Persoonlijke Map (VPM).
Gebruiker B heeft eventueel een Versleutelde Persoonlijke Map (VPM).
Maak gebruiker B aan (als Beheerder) als deze niet bestaat.
Van VPM naar niet-VPM gebruiker A:
1.  Aanmelden gebruiker A
2.  sudo cp -rp /home/A /home/A.backup
    (recursief en met behoud van bestaande bestandseigendom en -rechten)
3.  !!CONTROLEER DE BACKUP!! /home/A.backup
4.  Afmelden gebruiker A
5.  Aanmelden gebruiker B
6.  sudo rm -rf /home/A
7.  sudo rm /home/A.backup/.ecryptfs
    sudo rm /home/A.backup/.Private
    (Moet, anders is de encryptie-software niet te verwijderen)
8.  sudo mv /home/A.backup /home/A
Als B ook VPM heeft:
9.  sudo cp -rp /home/B /home/B.backup
10. !!CONTROLEER DE BACKUP!!
11. Afmelden gebruiker B
12. Aanmelden gebruiker A
13. sudo rm -rf /home/B
14. sudo rm /home/B.backup/.ecryptfs
    sudo rm /home/B.backup/.Private
    (Moet, anders is de encryptie-software niet te verwijderen)
15. sudo mv /home/B.backup /home/B
Verwijder de encryptie-software:
18. sudo apt-get remove ecryptfs-utils libecryptfs0
19. sudo rm -rf /home/.ecryptfs
Als gebruiker B is aangemaakt voor het overzetten:
20. Verwijder gebruiker B
Als swap ook is versleuteld:
21. sudo swapoff -a
22. sudo cryptsetup remove /dev/mapper/cryptswap1
23. sudo vi /etc/crypttab
    *Verwijder de /dev/sda5 regel*
24. sudo /sbin/mkswap /dev/sda5
25. sudo swapon /dev/sda5
26. sudo vi /etc/fstab
    *vervang /dev/mapper/cryptswap1 door /dev/sda5*
Maak een back-up:
21. cd /tmp;wget karelzimmer.nl/gs;bash gs
22. ./backup.sh
    Volg de aanwijzingen van het script.
Afronden:
23. Verwijder opgeslagen passphrases (papier -hoop van niet-, Sleutelkluis)
KLAAR

Gebruiker hernoemen
-------------------
1. Maak tijdelijke gebruiker temp aan met beheerdersrechten
2. Aanmelden als temp
3. sudo -i
4. killall -u oude-naam
5. usermod -l nieuwe-naam oude-naam
6. groupmod -n nieuwe-naam oude-naam
7. usermod -d /home/nieuwe-naam -m nieuwe-naam
8. usermod -c "Nieuwe echte naam" nieuwe-naam
9. Aanmelden als nieuwe-naam en gebruiker temp verwijderen
Hier als voorbeeld van Beheerder naar Karel.
 1. Maak tijdelijk een nieuwe gebruiker met beheerdersrechten, of geef een
    niet te hernoemen bestaande gebruiker beheerdersrechten.
 3. Start Terminalvenster
 2. sudo -i
 3. killall -u beheerder
 4. id beheerder
    UID=1001(beheerder) GID=1001(beheerder) groepen=1001(beheerder),4(adm),27(sudo),108(lpadmin),124(sambashare)
 5. usermod -l karel beheerder
 6. groupmod -n karel beheerder
 7. usermod -d /home/karel -m karel
 8. usermod -c "Karel Zimmer" karel
 9. id karel
    UID=1001(karel) GID=1001(karel) groepen=1001(karel),4(adm),27(sudo),108(lpadmin),124(sambashare)
10. Eigengemaakte Bladwijzers in Nautilus dienen opnieuw te worden gemaakt.
    Deze worden gelezen uit $HOME/.config/gtk-3.0/bookmarks en bevatten de oude
    locaties (file:///home/beheerder/... ...).

Lubuntu automatisch aanmelden
-----------------------------
sudo leafpad /etc/lightdm/lightdm.conf
SeatDefaults]
autologin-user=<gebruikersnaam>
autologin-user-timeout=0
user-session=Lubuntu
greeter-session=lightdm-gtk-greeter

Bestanden terughalen
--------------------
sudo apt install foremost
sudo foremost -t ole -i /dev/sda? -o /media/<harddisk>/foremost

Linux Mint Thema
----------------
1. Kopieer /usr/share/mdm/html-themes/Mint-X naar /home/beheerder/Thema/
2. Hernoem Mint-X naar Vermeer
3. Wijzig slideshow.conf zo dat alleen file:///opt/wallpapers/Vermeer-meisje-met-de-parel-groot.jpg erin staat
4. Vervang screenshot.jpg door /opt/wallpapers/Vermeer-meisje-met-de-parel-groot.jpg
5. Klik rechts op /home/beheerder/Thema/Vermeer, kies Comprimeren, en klik op Maken
6. Upload Vermeer.tar.gz naar website download-deel themas

Systeemgeluiden
---------------
canberra-gtk-play --id=<geluidstring>
canberra-gtk-play --file=<geluidsbestand>
Voor <geluidstring> zie:
/usr/share/sounds/
--id=<geluidfile> werkt met bestanden uit:
/usr/share/sounds/freedesktop/stereo/
en
/usr/share/sounds/ubuntu/stereo/
N.B. <geluidfile> zonder suffix zoals .ogg en .oga !
notify-send
-----------
Icons: /usr/share/icons/gnome/48x48/...
gedit highlighting #FIXME, #TODO, en #XXX
-----------------------------------------
http://stackoverflow.com/questions/4810497/document-and-control-fixme-and-todo-hightlighting-of-perl-comments-by-gedit
https://developer.gnome.org/gtksourceview/stable/lang-tutorial.html (zoek in-comment)
/usr/share/gtksourceview-?.0/language-specs/def.lang:
        <!-- Anything that needs extra attention; mostly the keywords TODO, FIXME and XXX -->
        <style id="note" _name="Note (FIXME, TODO, XXX, etc.)"/>
        <context id="in-comment" class-disabled="no-spell-check">
            <include>
                <context id="net-address" extend-parent="false" style-ref="underlined" class="no-spell-check">
                    <match>\%{net-address}</match>
                </context>
                <context id="email-address" extend-parent="false" style-ref="underlined" class="no-spell-check">
                    <match>\%{email-address}</match>
                </context>
                <context id="comment-note" extend-parent="false" style-ref="note" class="no-spell-check">
                    <match>\b(FIXME|TODO|XXX)\b</match>
                </context>
            </include>
        </context>

notify-send --urgency=low      --icon=dialog-info    "Regel1" "Regel2" # weg na ca. 5 sec.
notify-send --urgency=normal   --icon=dialog-warning "Regel1" "Regel2" # weg na ca. 5 sec.
notify-send --urgency=critical --icon=dialog-error   "Regel1" "Regel2" # moet weggeklikt worden

zenity --notification --window-icon=dialog-info    --text="Regel1\nRegel2" # weg na ca. 5 sec.
zenity --notification --window-icon=dialog-warning --text="Regel1\nRegel2" # weg na ca. 5 sec.
zenity --notification --window-icon=dialog-error   --text="Regel1\nRegel2" # weg na ca. 5 sec.

Bureaublad wordt niet goed getoond (geen juiste venster, geen starter)
----------------------------------------------------------------------
Zie eerst: http://askubuntu.com/questions/162075/
1. Niet-afgemaakte updates
2. Beschadigd bestandssysteem
3. Meer drastische methodes
4. Als dat het niet oplost
5. En nog verder gaan
1. Niet-afgemaakte updates.
Op het GNU GRUB opstartscherm kies Geavanceerde opties voor Ubuntu.
(Als dat menu niet verschijnt bij het opstarten, hou dan de Shift-toets
ingedrukt bij het opstarten.)
Kies dan Ubuntu, with Linux... (recovery mode).
Zorg dat het netwerk bedraad beschikbaar is en kies op het Herstelmenu eerst
network en daarna root.
In het Terminalvester voer uit:
apt-get update
apt-get upgrade
exit
Volg de eventuele aanwijzingen op het scherm (zoals sudo apt install -f).
Start de computer daarna weer op,
2. Beschadigd bestandssysteem
Op het GNU GRUB opstartscherm kies Geavanceerde opties voor Ubuntu.
Kies dan Ubuntu, with Linux... (recovery mode).
Kies op het Herstelmenu voor fsck.
Volg de aanwijzingen op het scherm.
3. Meer drastische methodes:
Op het Aanmeldscherm/Bureaublad probeer een Terminalvenster te openen met
Ctrl+Alt+T of Ctrl+Alt+F1.
Voer in het Terminalvenster uit:
sudo rm -fr $HOME/.cache/compizconfig-1
sudo rm -fr $HOME/.compiz
sudo rm -fr $HOME/.Xauthority
sudo rm -fr $HOME/.config/autostart
4. En nog verder gaan (verwijdert alle, mogelijk foutieve, configuratie-data):
rm -rf $HOME/.config

Verwijder EXIF-informatie verborgen in JPEG-bestanden
-----------------------------------------------------
sudo apt install libimage-exiftool-perl
for i in *[.jpg,.JPG]; do echo "Processing $i"; exiftool -all= "$i"; done

Aanmeldfoto aanbrengen
----------------------
if ! grep --quiet '^Icon=' /var/lib/AccountsService/users/${SUDO_USER:-$USER}
then
    echo 'Icon=/usr/share/pixmaps/faces/penguin' |
    sudo tee --append /var/lib/AccountsService/users/${SUDO_USER:-$USER} \
    > /dev/null
fi

Silverlight/Moonlight
---------------------
sudo add-apt-repository --yes ppa:pipelight/stable
sudo apt-get update
sudo apt-get install --install-recommends --yes pipelight-multi
sudo pipelight-plugin --update
sudo pipelight-plugin --enable silverlight
sudo pipelight-plugin --create-mozilla-plugins
sudo pipelight-plugin --list-enabled . . . list enabled plugins
http://bubblemark.com/silverlight2.html  . testsite

Google Drive
------------
Ref: http://www.omgubuntu.co.uk/2016/08/use-google-drive-ubuntu-16-04-linux-desktops
Terminal:
sudo apt install gnome-control-center gnome-online-accounts
gnome-control-center online-accounts
Voeg je Google-account toe en zorg dat Bestanden aan staat.
Open Bestanden en klik op je Google-account.
Miniatuurafbeeldingen tonen:
Bewerken > Voorkeuren > Voorbeeld (tab) > Miniatuurafbeeldingen tonen: Altijd.

Gnome Terminal
--------------
Als Ctrl-Alt-T niet meer GNOME TErminal opent:
gsettings set org.gnome.desktop.default-applications.terminal exec '/usr/bin/gnome-terminal'

Script hardening
----------------
set -o errexit                          # Stop als opdracht niet-nul eindigt
set -o nounset                          # Stop als variabele ongebonden is
set -o pipefail                         # Pipe eindigt met hoogste rc
#et -o noexec                           # Opdrachten niet uitvoeren
#et -o verbose                          # Opdracht tonen voor uitvoering
#et -o xtrace                           # Resultaat van de opdracht tonen
Settings opvragen:
- echo $-           (Voorbeeld: himBH)
- echo $SHELLOPTS   (Voorbeeld: braceexpand:emacs:hashall:histexpand:history:interactive-comments:monitor)
- set -o            (
    allexport      	off
    braceexpand    	on
    emacs          	on
    errexit        	off
    errtrace       	off
    functrace      	off
    hashall        	on
    histexpand     	on
    history        	on
    ignoreeof      	off
    interactive-comments	on
    keyword        	off
    monitor        	on
    noclobber      	off
    noexec         	off
    noglob         	off
    nolog          	off
    notify         	off
    nounset        	off
    onecmd         	off
    physical       	off
    pipefail       	off
    posix          	off
    privileged     	off
    verbose        	off
    vi             	off
    xtrace         	off)

Script tab-completion
---------------------
Zie scripts script_completion* en 'help compgen'.
complete -p         bestaande completeringsvoorschriften, grep 'script'
declare -f _script  toont inhoud gebruikte functie
Zie:
https://askubuntu.com/questions/68175
https://debian-administration.org/article/316/An_introduction_to_bash_completion_part_1
https://debian-administration.org/article/317/An_introduction_to_bash_completion_part_2

Van VirtualBox naar Virt-Manager
--------------------------------
Converteer VBox VM's <disk> naar raw-formaat (niet gecomprimeerd):
VBoxManage clonehd <disk>.vdi <disk>.raw --format raw
VBoxManage clonehd /media/karel/Lacie/Backups/hugowin732/hugowin32.vdi /media/karel/Lacie/Backups/hugowin732/hugowin32.raw --format raw
0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Clone medium created in format 'raw'. UUID: 3cca27d7-2b81-4d9e-8155-1cc49832b8b5
09:24-14:07 (4u43m),  107,2GB naar 107,4GB
Converteer raw-formaat naar KVM-formaat (ruimte besparen):
qemu-img convert -f raw <disk>.raw -O qcow2 <disk>.qcow2
qemu-img convert -f raw /media/karel/Lacie/Backups/hugowin732/hugowin32.raw  -O qcow2 hugowin32.qcow2
15:27-16:24  (1u) 107,4GB naar 106,0GB

Wacht tot ander softwarebeheerders klaar zijn
---------------------------------------------
    # Wacht op unattended-upgrades, update, en upgrade (draait iedere keer).
    aptdcon --safe-upgrade
    # Idem, eigenbouw (draait alleen indien nodig).
    while sudo fuser /var/{lib/{dpkg,apt/lists},cache/apt/archives}/lock \
>/dev/null 2>&1; do
       info "\rWachten totdat andere softwarebeheerders klaar zijn...\c"
       sleep 1
    done
    info

Start sar (sadc - system activity datacollector; backend to sar)
----------------------------------------------------------------
1. sudo apt-get install sysstat
2. sudo vi /etc/default/sysstat
    ENABLED="false" -> ENABLED="true"
3. sudi vi /etc/cron.d/sysstat
    5-55/10  * * * * -> * * * * *
4. sudo systemctl restart sysstat

Alle bureaubladachtergronden installeren
----------------------------------------
sudo apt-get install ubuntu-wallpapers-*
/usr/share/backgrounds/

Voeg LUKS-wachtwoord toe
------------------------
sudo blkid -t TYPE=crypto_LUKS
    (-t = --match-tag)
voorbeeld output: /dev/sda5: UUID="f0b919d7-7789-4141-9505-3ea86135972a" TYPE="crypto_LUKS" PARTUUID="71559985-05"

sudo cryptsetup luksAddKey /dev/sda5
Geef bestaand ww op, voeg daarna extra ww toe.

Check met: sudo cryptsetup luksDump /dev/sda5
Voorbeeld output:
LUKS header information for /dev/sda5

Version:           1
Cipher name:       aes
Cipher mode:       xts-plain64
Hash spec:         sha256
Payload offset:    4096
MK bits:           512
MK digest:         b6 f4 3c fb 8d 84 11 df 4a a5 2c d1 b2 bc 3d e6 9d e8 53 70
MK salt:           99 bb 73 d1 d6 6b 06 0f 24 df 1b 9d 34 ab 6f 84
                   14 55 59 67 68 df 88 35 af e6 ca 86 22 89 81 72
MK iterations:     65339
UUID:              f0b919d7-7789-4141-9505-3ea86135972a

Key Slot 0: ENABLED                                 <== met installatie opgegeven
    Iterations:             1045438
    Salt:                   56 23 3a e4 f0 64 bd 34 07 71 c8 f2 c0 a9 19 65
                              bb 6c 08 44 ce b5 50 93 72 c1 24 87 7a 0b fc 70
    Key material offset:    8
    AF stripes:                4000
Key Slot 1: ENABLED                                 <== met luksAddKey opgegeven
    Iterations:             994852
    Salt:                   da 2d a8 4c 8c 04 84 30 c6 1c 36 61 6a 86 80 e1
                              fe 81 57 93 79 49 53 20 c9 76 4d 5d 7b 1d 9c 84
    Key material offset:    512
    AF stripes:                4000
Key Slot 2: DISABLED
Key Slot 3: DISABLED
Key Slot 4: DISABLED
Key Slot 5: DISABLED
Key Slot 6: DISABLED
Key Slot 7: DISABLED

Wijzig LUKS-wachtwoord
----------------------
sudo blkid -t TYPE=crypto_LUKS
    (-t = --match-tag)
voorbeeld output: /dev/sda5: UUID="f0b919d7-7789-4141-9505-3ea86135972a" TYPE="crypto_LUKS" PARTUUID="71559985-05"

sudo cryptsetup luksChangeKey /dev/sda5
Geef het te wijzigen ww op, geeft daarna het nieuwe ww

Verwijder LUKS-wachtwoord
-------------------------
sudo blkid -t TYPE=crypto_LUKS
    (-t = --match-tag)
voorbeeld output: /dev/sda5: UUID="f0b919d7-7789-4141-9505-3ea86135972a" TYPE="crypto_LUKS" PARTUUID="71559985-05"

sudo cryptsetup luksRemoveKey /dev/sda5
Geef te verwijderen wachtwoord(en) op.

Check met: sudo cryptsetup luksDump /dev/sda5
Voorbeeld output:
LUKS header information for /dev/sda5

Version:           1
Cipher name:       aes
Cipher mode:       xts-plain64
Hash spec:         sha256
Payload offset:    4096
MK bits:           512
MK digest:         b6 f4 3c fb 8d 84 11 df 4a a5 2c d1 b2 bc 3d e6 9d e8 53 70
MK salt:           99 bb 73 d1 d6 6b 06 0f 24 df 1b 9d 34 ab 6f 84
                   14 55 59 67 68 df 88 35 af e6 ca 86 22 89 81 72
MK iterations:     65339
UUID:              f0b919d7-7789-4141-9505-3ea86135972a

Key Slot 0: ENABLED                                 <== met installatie opgegeven
    Iterations:             1045438
    Salt:                   56 23 3a e4 f0 64 bd 34 07 71 c8 f2 c0 a9 19 65
                              bb 6c 08 44 ce b5 50 93 72 c1 24 87 7a 0b fc 70
    Key material offset:    8
    AF stripes:                4000
Key Slot 1: DISABLED                                <== met luksRemoveKey verwijderd
Key Slot 2: DISABLED
Key Slot 3: DISABLED
Key Slot 4: DISABLED
Key Slot 5: DISABLED
Key Slot 6: DISABLED
Key Slot 7: DISABLED

Extra LUKS-info
---------------
Mocht je het wachtwoord van slot 0 vergeten zijn,
en je weet nog het wachtwoord van slot 1,
voer dan uit:
sudo cryptsetup luksKillSlot /dev/sda5 0

dm-crypt is a transparent disk encryption subsystem in Linux kernel versions 2.6 and later and in DragonFly BSD.
It is part of the device mapper infrastructure, and uses cryptographic routines from the kernel's Crypto API.
Unlike its predecessor cryptoloop, dm-crypt was designed to support advanced modes of operation, such as XTS,
LRW and ESSIV (see disk encryption theory for further information), in order to avoid watermarking attacks.
In addition to that, dm-crypt also addresses some reliability problems of cryptoloop.

dm-crypt is implemented as a device mapper target and may be stacked on top of other device mapper transformations.
It can thus encrypt whole disks (including removable media), partitions, software RAID volumes, logical volumes, as well as files.
It appears as a block device, which can be used to back file systems, swap or as an LVM physical volume.

Some Linux distributions support the use of dm-crypt on the root file system. <== Ubuntu o.a.
These distributions use initrd to prompt the user to enter a passphrase at the console, or insert a smart card prior to the normal boot process.

Zoek en verwijder dubbele bestanden
-----------------------------------
FSlint: GUI tool to find and remove duplicate files (GUI)
sudo apt install fslint
fslint-gui                      (rapporteer v/a huidige dir)
fslint-gui /path/to/folder      (rapporteer vanaf /path/to/folder)

FDUPES: CLI tool to find and remove duplicate files (TUI)
sudo apt install fdupes
fdupes -r /home                 (rapporteer recursief v/a /home)
fdupes -d /path/to/folder       (verwijder, interactief, vanaf /path/to/folder)
fdupes -d -N /path/to/folder    (verwijder, z/bevestiging, vanaf /path/to/folder)

snaps
-----
[sudo] snap find            zoek naar beschikbare snaps (zie ook https://snapcraft.io/store)
[sudo] snap find ZOEKARG    zoek naar snaps die overeenkomen met ZOEKARG
[sudo] snap install SNAP    installeer SNAP
[sudo] snap refresh SNAP    update SNAP, autom. iedere 24 uur
sudo snap refresh --list    toon welke snaps bijgewerkt kunnen worden
sudo snap refresh all       update alle snaps
sudo snap refresh SNAP --channel=CHANNEL    schakel voor snap SNAP over naar kanaal CHANNEL; bijv. stable, candidate, beta, edge
snap list                   toon geïnstalleerde snaps
snap changes                toon historie van recente wijzigingen aan het systeem door snap
sudo snap revert SNAP       val terug op een oude versie
sudo snap remove SNAP       verwijder SNAP

Wifi
----
lspci | grep -i netw
00:19.0 Ethernet controller: Intel Corporation 82579LM Gigabit Network Connection (Lewisville) (rev 04)
03:00.0 Network controller: Intel Corporation Centrino Advanced-N 6205 [Taylor Peak] (rev 34)
lspci -vv -s 03:00.0
sudo lshw -C network
nmcli dev wifi
watch -n 1 cat /proc/net/wireless

sudo apt install wavemon
wavemon

iwevent
iwgetid

Einde tekstbestand.
